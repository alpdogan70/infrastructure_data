# InfluxDB Outputs for Energy AI
# File: /etc/telegraf/telegraf.d/energy_ai_outputs.conf
# Generated by Ansible - Energy Intelligence Role

# ================== ENERGY AI INFLUXDB OUTPUTS ==================

# Output to Energy AI main bucket
[[outputs.influxdb_v2]]
  urls = ["{{ influxdb_url | default('http://localhost:8086') }}"]
  token = "{{ influxdb_token.content | b64decode | trim if influxdb_token is defined else 'demo-token' }}"
  organization = "{{ influxdb_org | default('iot') }}"
  bucket = "energy_ai"
  timeout = "5s"
  namepass = ["energy_ai_predictions", "energy_ai_recommendations"]
  
  [outputs.influxdb_v2.tagpass]
    source = ["energy_ai"]

# Output to Scenarios bucket
[[outputs.influxdb_v2]]
  urls = ["{{ influxdb_url | default('http://localhost:8086') }}"]
  token = "{{ influxdb_token.content | b64decode | trim if influxdb_token is defined else 'demo-token' }}"
  organization = "{{ influxdb_org | default('iot') }}"
  bucket = "energy_scenarios"
  timeout = "5s"
  namepass = ["energy_scenarios_data"]
  
  [outputs.influxdb_v2.tagpass]
    source = ["energy_scenarios"]

# Output to Weather ML bucket
[[outputs.influxdb_v2]]
  urls = ["{{ influxdb_url | default('http://localhost:8086') }}"]
  token = "{{ influxdb_token.content | b64decode | trim if influxdb_token is defined else 'demo-token' }}"
  organization = "{{ influxdb_org | default('iot') }}"
  bucket = "weather_ml"
  timeout = "5s"
  namepass = ["weather_ml_data"]
  
  [outputs.influxdb_v2.tagpass]
    source = ["weather_ml"]

# Output to Cost Optimization bucket
[[outputs.influxdb_v2]]
  urls = ["{{ influxdb_url | default('http://localhost:8086') }}"]
  token = "{{ influxdb_token.content | b64decode | trim if influxdb_token is defined else 'demo-token' }}"
  organization = "{{ influxdb_org | default('iot') }}"
  bucket = "cost_optimization"
  timeout = "5s"
  namepass = ["cost_optimization_data"]
  
  [outputs.influxdb_v2.tagpass]
    source = ["cost_optimizer"]

# Output to Carbon Metrics bucket
[[outputs.influxdb_v2]]
  urls = ["{{ influxdb_url | default('http://localhost:8086') }}"]
  token = "{{ influxdb_token.content | b64decode | trim if influxdb_token is defined else 'demo-token' }}"
  organization = "{{ influxdb_org | default('iot') }}"
  bucket = "carbon_metrics"
  timeout = "5s"
  namepass = ["carbon_footprint_data"]
  
  [outputs.influxdb_v2.tagpass]
    source = ["carbon_calculator"]

# Output to Model Performance bucket (AI metrics)
[[outputs.influxdb_v2]]
  urls = ["{{ influxdb_url | default('http://localhost:8086') }}"]
  token = "{{ influxdb_token.content | b64decode | trim if influxdb_token is defined else 'demo-token' }}"
  organization = "{{ influxdb_org | default('iot') }}"
  bucket = "model_performance"
  timeout = "5s"
  namepass = ["energy_ai_predictions"]
  
  # Only send performance metrics
  [outputs.influxdb_v2.fieldpass]
    fieldpass = ["confidence_score", "prediction_accuracy", "model_version"]