---
# DÃ©ploiement des moteurs IA Ã©nergÃ©tique
# File: ansible/roles/energy_intelligence/tasks/deploy_ai_engines.yml

- name: "ğŸ§  DÃ©ploiement moteur de prÃ©diction IA"
  template:
    src: energy_predictor.py.j2
    dest: "{{ energy_ai_paths.base }}/energy_predictor.py"
    owner: root
    group: root
    mode: '0755'
    backup: yes
  notify: restart energy-ai-predictor
  tags: ['predictor']

- name: "ğŸ¯ DÃ©ploiement moteur de scÃ©narios dynamiques"
  template:
    src: scenario_engine.py.j2
    dest: "{{ energy_ai_paths.base }}/scenario_engine.py"
    owner: root
    group: root
    mode: '0755'
    backup: yes
  notify: restart energy-scenarios
  tags: ['scenarios']

- name: "ğŸŒ¤ï¸ DÃ©ploiement intÃ©gration mÃ©tÃ©o ML"
  template:
    src: weather_ml_model.py.j2
    dest: "{{ energy_ai_paths.base }}/weather_ml_model.py"
    owner: root
    group: root
    mode: '0755'
    backup: yes
  notify: restart weather-ml
  tags: ['weather']

- name: "ğŸ’° DÃ©ploiement optimiseur de coÃ»ts"
  template:
    src: cost_optimizer.py.j2
    dest: "{{ energy_ai_paths.base }}/cost_optimizer.py"
    owner: root
    group: root
    mode: '0755'
    backup: yes
  notify: restart cost-optimizer
  tags: ['cost_optimizer']

- name: "ğŸŒ± DÃ©ploiement calculateur empreinte carbone"
  template:
    src: carbon_footprint.py.j2
    dest: "{{ energy_ai_paths.base }}/carbon_footprint.py"
    owner: root
    group: root
    mode: '0755'
    backup: yes
  tags: ['carbon']

- name: "âš™ï¸ DÃ©ploiement script d'initialisation IA"
  template:
    src: init_ai_system.py.j2
    dest: "{{ energy_ai_paths.base }}/init_ai_system.py"
    owner: root
    group: root
    mode: '0755'
  tags: ['init']

- name: "ğŸ“Š DÃ©ploiement utilitaires IA"
  template:
    src: "{{ item }}.j2"
    dest: "{{ energy_ai_paths.base }}/{{ item }}"
    owner: root
    group: root
    mode: '0755'
  loop:
    - ai_diagnostics.py
    - model_trainer.py
    - data_collector.py
    - performance_monitor.py
  tags: ['utilities']

- name: "ğŸ”§ Configuration API keys et credentials"
  template:
    src: configs/{{ item }}.j2
    dest: "{{ energy_ai_paths.configs }}/{{ item }}"
    owner: root
    group: root
    mode: '0600'  # Permissions restrictives pour sÃ©curitÃ©
  loop:
    - weather_config.json
    - electricity_config.json
    - carbon_config.json
    - ai_credentials.json
  tags: ['config']

- name: "ğŸ“‹ CrÃ©ation fichier configuration principale IA"
  template:
    src: configs/energy_ai_config.yaml.j2
    dest: "{{ energy_ai_paths.configs }}/energy_ai_config.yaml"
    owner: root
    group: root
    mode: '0644'
  tags: ['config']

- name: "ğŸ¯ Test syntaxe scripts Python IA"
  command: "{{ python_ai.venv_path }}/bin/python -m py_compile {{ energy_ai_paths.base }}/{{ item }}"
  loop:
    - energy_predictor.py
    - scenario_engine.py
    - weather_ml_model.py
    - cost_optimizer.py
    - carbon_footprint.py
  register: python_syntax_check
  failed_when: python_syntax_check.rc != 0
  changed_when: false
  tags: ['test']

- name: "ğŸ“Š Test imports dÃ©pendances ML"
  command: |
    {{ python_ai.venv_path }}/bin/python -c "
    import numpy, pandas, sklearn
    print('âœ… Imports ML rÃ©ussis')
    "
  register: ml_imports_test
  changed_when: false
  tags: ['test']

- name: "ğŸ“‹ RÃ©sumÃ© dÃ©ploiement moteurs IA"
  debug:
    msg: |
      âœ… Moteurs IA dÃ©ployÃ©s avec succÃ¨s:
      ğŸ§  Energy Predictor - {{ energy_ai_paths.base }}/energy_predictor.py
      ğŸ¯ Scenario Engine - {{ energy_ai_paths.base }}/scenario_engine.py  
      ğŸŒ¤ï¸ Weather ML - {{ energy_ai_paths.base }}/weather_ml_model.py
      ğŸ’° Cost Optimizer - {{ energy_ai_paths.base }}/cost_optimizer.py
      ğŸŒ± Carbon Calculator - {{ energy_ai_paths.base }}/carbon_footprint.py
      
      ğŸ”§ Configuration: {{ energy_ai_paths.configs }}/
      ğŸ“Š Tests syntaxe: {{ 'RÃ‰USSIS' if python_syntax_check.results | selectattr('rc', 'equalto', 0) | list | length == 5 else 'Ã‰CHOUÃ‰S' }}
      ğŸ“š Imports ML: {{ 'RÃ‰USSIS' if ml_imports_test.rc == 0 else 'Ã‰CHOUÃ‰S' }}